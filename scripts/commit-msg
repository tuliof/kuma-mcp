#!/bin/sh
#
# Git commit-msg hook that enforces semantic commit messages
# Format: <type>(<scope>): <subject>
# Where:
#   - type: chore, docs, feat, fix, refactor, style, or test
#   - scope: optional
#   - subject: present tense summary
#
# Examples:
#   feat: add new feature
#   feat(api): add new endpoint
#   fix(ui): resolve button styling issue
#   docs: update README

commit_msg_file="$1"
commit_msg=$(cat "$commit_msg_file")

# Ignore merge commits
if echo "$commit_msg" | grep -qE "^Merge"; then
    exit 0
fi

# Ignore revert commits
if echo "$commit_msg" | grep -qE "^Revert"; then
    exit 0
fi

# Semantic commit message regex pattern
# Matches: type(optional-scope): subject
pattern="^(chore|docs|feat|fix|refactor|style|test)(\(.+\))?: .+"

if ! echo "$commit_msg" | grep -qE "$pattern"; then
    echo "❌ ERROR: Invalid commit message format"
    echo ""
    echo "Commit message must follow semantic commit format:"
    echo "  <type>(<scope>): <subject>"
    echo ""
    echo "Where:"
    echo "  - type: chore, docs, feat, fix, refactor, style, or test"
    echo "  - scope: optional, can be any identifier"
    echo "  - subject: brief description in present tense"
    echo ""
    echo "Examples:"
    echo "  ✓ feat: add hat wobble"
    echo "  ✓ feat(api): add new endpoint"
    echo "  ✓ fix(ui): resolve button styling"
    echo "  ✓ docs: update README"
    echo "  ✓ test: add unit tests for parser"
    echo ""
    echo "Your commit message:"
    echo "  $commit_msg"
    echo ""
    exit 1
fi

exit 0
