#!/bin/sh
# Shared commit-msg hook (tracked in repo)
# Enforces semantic commit messages: <type>(<scope>): <subject>
# Allowed types: chore, docs, feat, fix, refactor, style, test

commit_msg_file="$1"
commit_msg=$(cat "$commit_msg_file")

# Ignore merge commits
if echo "$commit_msg" | grep -qE "^Merge"; then
    exit 0
fi

# Ignore revert commits
if echo "$commit_msg" | grep -qE "^Revert"; then
    exit 0
fi

pattern="^(chore|docs|feat|fix|refactor|style|test)(\(.+\))?: .+"

if ! echo "$commit_msg" | grep -qE "$pattern"; then
    echo "‚ùå ERROR: Invalid commit message format"
    echo ""
    echo "Commit message must follow: <type>(<scope>): <subject>"
    echo "Allowed types: chore, docs, feat, fix, refactor, style, test"
    echo ""
    echo "Your commit message:"; echo "---"; echo "$commit_msg"; echo "---"
    exit 1
fi

exit 0
